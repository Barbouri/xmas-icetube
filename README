##################
## xmas-icetube ##
##################

My father gave me an Ice Tube Clock kit from Adafruit as a Christmas gift last
year.  As an excuse to learn AVR programming, I started playing with the
software.  Eventually, none of the original code remained and the project
became a feature-rich reimplementation of the original Adafruit firmware.

  John Archie <www.jarchie.com>
  December 27, 2012


##############
## Features ##
##############

Many of the features in the xmas-icetube firmware were first implemented in
other firmware projects; see the CREDITS file for details.  This firmware
boasts the following features.

  - animated display transitions
  - multiple time and date formats
  - optionally pulse display during alarm and snooze
  - three alarm times for selectable days of the week
  - adjustable alarm volume (from 0 to 10)
  - progressive alarm option (gradually increasing volume)
  - multiple alarm sounds (beeps, Merry Christmas, Big Ben, or Reveille)
  - adjustable snooze duration
  - DST support (USA, EU, or manual)
  - fully automatic correction for time drift
  - time-from-GPS support*
  - no beeping or time loss when power fails
  - 25-fold increase in backup battery life*
  - functional alarm during power outage**
  - per-digit brightness adjustment for uneven displays
  - automatic brightness control by ambient light*
  - optionally disable display during specified time periods
  - optionally disable display at night (when dark)*

*  These hacks require hardware modification and support must be enabled by
   uncommenting macros in config.h.  See the HACKS AND MODS section of
   this file as well as the comments in config.h for more information.

** The snooze feature, musical alarm, and progressive alarm, are automatically
   disabled during a power failure.  While on battery power, the buzzer alarm
   sounds at the menu-settable maximum volume and the alarm can only be enabled
   or disabled via the alarm on/off switch.  All other inputs are ignored until
   power is restored.


For Ice Tube Clock hackers, this firmware has

    (1) compatibility with the atmega328p,
    (2) a pseudo object-oriented design,
    (3) reasonably good commenting, and
    (4) display/menus by finite state machine.


##################
## Installation ##
##################

Installation requires GNU Make, avr-libc, avr-gcc, and avrdude; the
instructions below presume proficiency with these tools.

In regard to hardware, this Makefile is setup to build and install the
firmware for the Adafruit Ice Tube Clock with an ATmega328P.
Unfortunately, this firmware is currently too large to work on the
ATmega168V.  Programming has been tested with the Adafruit USBtinyISP,
but other programmers should also work (in theory).

In regard to software, compilation and installation seems to work under

    (a) Ubuntu Linux 12.04 with the avr-gcc and avrdude packages,
    (b) Mac OS 10.6 with MacPorts' avr-gcc and avrdude packages, and
    (c) Windows 7 with WinAVR and Cygwin's perl and bash packages.

To compile and install this firmware, first configure compile-time
options by editing config.h; then, build and install the project using
the included Makefile:

(1) Edit the Configuration Variables

    First, review the macro definitions in config.h, changing macro
    definitions as needed to enable support for various hardware hacks.

    Next, review the Makefile to ensure that configuration variables
    are reasonable given your hardware.  In particular, AVRMCU, AVRISP,
    and AVRDUDEOPT seem most likely to require attention.

(2) Compile the Firmware

    Build icetube_flash.hex and icetube_eeprom.hex, which contain
    the firmware and initial EEPROM contents:

	% make

(3) Install the Firmware

    Write the new fuse bits, which *do* differ from those in the original
    Adafruit firmware and other alternative firmware projects:

	% make install-fuse

    Finally, upload the compiled firmware and initial EEPROM contents:

	% make install


####################
## HACKS AND MODS ##
####################

Development of the various hacks and mods supported by this firmware
have been discussed extensively in the Adafruit discussion board.

::Automatic Dimmer::
http://forums.adafruit.com/viewtopic.php?f=41&t=12932

::Extended Battery Hack::
http://forums.adafruit.com/viewtopic.php?f=41&t=36697

::Temperature Compensated Timekeeping::
http://forums.adafruit.com/viewtopic.php?f=41&t=14941

::GPS Timekeeping::
http://forums.adafruit.com/viewtopic.php?f=41&t=36873
http://www.ladyada.net/make/icetube/mods.html
http://forums.adafruit.com/viewtopic.php?f=41&t=32660

::Drift Correction::
http://forums.adafruit.com/viewtopic.php?f=41&t=12720

::Per-Digit Brightness Adjustment::
http://forums.adafruit.com/viewtopic.php?f=41&t=23586
